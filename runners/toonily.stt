(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.STTPackage = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Target = void 0;
const daisuke_1 = require("@suwatte/daisuke");
const cheerio_1 = require("cheerio");
const madara_1 = require("../../template/madara");
const constants_1 = require("../../template/madara/constants");
const utils_1 = require("../../template/madara/utils");
class Target extends madara_1.MadaraTemplate {
    info = {
        id: "com.toonily",
        name: "Toonily",
        thumbnail: "toonily.png",
        version: 1.3,
        website: "https://toonily.com",
        supportedLanguages: ["EN_US"],
        nsfw: true,
        minSupportedAppVersion: "5.0",
        config: {
            authenticationMethod: daisuke_1.AuthMethod.WEB,
        },
    };
    constructor() {
        super({
            ...constants_1.DEFAULT_CONTEXT,
            baseUrl: "https://toonily.com",
            contentPath: "webtoon",
            tagSelector: ".wp-manga-tags-list > a",
            filterNonMangaItems: false,
            chapterUseAJAX: true,
            searchSelector: "div.page-item-detail.manga",
            useLoadMoreSearch: false,
            dateFormat: "MMM d, yyyy",
            paginationLimit: 18,
        });
    }
    async onSourceLoaded() {
        this.controller.client.transformRequest = async (req) => {
            return {
                ...req,
                headers: {
                    ...(req.headers ?? {}),
                    referer: this.context.baseUrl + "/",
                },
                cookies: [
                    {
                        name: "wpmanga-adault",
                        domain: ".toonily.com",
                        value: "1",
                    },
                    {
                        name: "toonily-mature",
                        domain: ".toonily.com",
                        value: "1",
                    },
                ],
            };
        };
    }
    async willRequestWebViewAuth() {
        return {
            url: this.info.website,
        };
    }
    async didReceiveAuthenticationCookieFromWebView(cookie) {
        return cookie.name.includes("wordpress_logged_in");
    }
    async getAuthenticatedUser() {
        const response = await this.controller.client.get("https://toonily.com/user-settings/?tab=account-settings");
        const $ = (0, cheerio_1.load)(response.data);
        const username = $("#form-account-settings > div > div:nth-child(2) > div:nth-child(2) > div > span").text();
        const avatar = (0, utils_1.imageFromElement)($(".c-user-avatar > img"));
        if (!username) {
            return null;
        }
        return {
            id: username,
            username,
            avatar,
            info: [],
        };
    }
}
exports.Target = Target;

},{"../../template/madara":4,"../../template/madara/constants":2,"../../template/madara/utils":6,"@suwatte/daisuke":9,"cheerio":"cheerio"}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.YEAR_DATE_LIST = exports.MONTH_DATE_LIST = exports.WEEK_DATE_LIST = exports.SECONDS_DATE_LIST = exports.MINUTE_DATE_LIST = exports.HOUR_DATE_LIST = exports.DAY_DATE_LIST = exports.CANCELLED_STATUS_LIST = exports.HIATUS_STATUS_LIST = exports.ONGOING_STATUS_LIST = exports.COMPLETED_STATUS_LIST = exports.TAG_PREFIX = exports.DEFAULT_CONTEXT = exports.EXPLORE_SECTIONS = exports.AJAX_DIRECTORY = void 0;
const daisuke_1 = require("@suwatte/daisuke");
var AJAX_DIRECTORY;
(function (AJAX_DIRECTORY) {
    AJAX_DIRECTORY["LATEST"] = "latest";
    AJAX_DIRECTORY["NAME"] = "alphabet";
    AJAX_DIRECTORY["TRENDING_WEEKLY"] = "trending_weekly";
    AJAX_DIRECTORY["TRENDING_DAILY"] = "trending_daily";
    AJAX_DIRECTORY["TRENDING_MONTHLY"] = "trending_monthly";
    AJAX_DIRECTORY["POPULAR_AT"] = "popular_allTime";
    AJAX_DIRECTORY["COMPLETED"] = "completed";
    AJAX_DIRECTORY["TOP_RATED"] = "rating";
    AJAX_DIRECTORY["NEW"] = "new";
})(AJAX_DIRECTORY = exports.AJAX_DIRECTORY || (exports.AJAX_DIRECTORY = {}));
exports.EXPLORE_SECTIONS = [
    {
        id: AJAX_DIRECTORY.POPULAR_AT,
        title: "Popular Titles",
        subtitle: `The "Must Reads"`,
        style: daisuke_1.CollectionStyle.INFO,
    },
    {
        id: AJAX_DIRECTORY.TRENDING_DAILY,
        title: "Trending Daily",
        subtitle: `What we're "reading"`,
        style: daisuke_1.CollectionStyle.NORMAL,
    },
    {
        id: AJAX_DIRECTORY.NEW,
        title: "Recently Added Series",
        subtitle: `Fresh from the bakery, discover new stories`,
        style: daisuke_1.CollectionStyle.NORMAL,
    },
    {
        id: AJAX_DIRECTORY.TRENDING_WEEKLY,
        title: "Trending Weekly",
        subtitle: `Top Reads from this past week.`,
        style: daisuke_1.CollectionStyle.NORMAL,
    },
    {
        id: AJAX_DIRECTORY.TOP_RATED,
        title: "Top Rated Titles",
        subtitle: `Guaranteed Bangers ðŸ”¥`,
        style: daisuke_1.CollectionStyle.NORMAL,
    },
    {
        id: AJAX_DIRECTORY.TRENDING_MONTHLY,
        title: "Trending Monthly",
        subtitle: `Top Reads from this past month.`,
        style: daisuke_1.CollectionStyle.NORMAL,
    },
    {
        id: AJAX_DIRECTORY.COMPLETED,
        title: "Completed Titles",
        subtitle: `Perfect for binging.`,
        style: daisuke_1.CollectionStyle.NORMAL,
    },
    {
        id: AJAX_DIRECTORY.LATEST,
        title: "Latest Updates",
        style: daisuke_1.CollectionStyle.UPDATE_LIST,
    },
];
exports.DEFAULT_CONTEXT = {
    baseUrl: "",
    contentPath: "manga",
    searchPath: "page",
    searchSelector: ".c-tabs-item__content",
    imageSelector: "div.page-break > img",
    chapterUseAJAX: false,
    useLoadMoreSearch: true,
    filterNonMangaItems: true,
    showOnlyManga: true,
    titleSelector: "div.post-title h3, div.post-title h1",
    authorSelector: "div.author-content > a",
    artistSelector: "div.artist-content > a",
    statusSelector: "div.summary-content",
    summarySelector: "div.description-summary div.summary__content, div.summary_content div.post-content_item > h5 + div, div.summary_content div.manga-excerpt",
    thumbnailSelector: "div.summary_image img",
    genreSelector: "div.genres-content > a",
    tagSelector: "div.tags-content a",
    typeSelector: ".post-content_item:contains(Type) .summary-content",
    alternativeTitlesSelector: ".post-content_item:contains(Alt) .summary-content",
    forceAdult: false,
    adultTags: ["mature"],
    chapterSelector: "li.wp-manga-chapter",
    chapterDateSelector: "span.chapter-release-date",
};
exports.TAG_PREFIX = {
    author: "author",
    artist: "artist",
    hashtag: "hashtag",
};
exports.COMPLETED_STATUS_LIST = [
    "Completed",
    "Completo",
    "ConcluÃ­do",
    "Concluido",
    "TerminÃ©",
    "HoÃ n ThÃ nh",
    "Ù…ÙƒØªÙ…Ù„Ø©",
    "Ù…ÙƒØªÙ…Ù„",
];
exports.ONGOING_STATUS_LIST = [
    "OnGoing",
    "ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÑ‚ÑÑ",
    "Updating",
    "Em LanÃ§amento",
    "Em lanÃ§amento",
    "Em andamento",
    "Em Andamento",
    "En cours",
    "Ativo",
    "LanÃ§ando",
    "Äang Tiáº¿n HÃ nh",
    "Devam Ediyor",
    "Devam ediyor",
    "In Corso",
    "In Arrivo",
    "Ù…Ø³ØªÙ…Ø±Ø©",
    "Ù…Ø³ØªÙ…Ø±",
    "En Curso",
];
exports.HIATUS_STATUS_LIST = ["On Hold"];
exports.CANCELLED_STATUS_LIST = ["Canceled"];
exports.DAY_DATE_LIST = [
    "hari",
    "gÃ¼n",
    "jour",
    "dÃ­a",
    "dia",
    "day",
    "à¸§à¸±à¸™",
    "ngÃ y",
    "giorni",
    "Ø£ÙŠØ§Ù…",
];
exports.HOUR_DATE_LIST = [
    "jam",
    "saat",
    "heure",
    "hora",
    "hour",
    "à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡",
    "giá»",
    "ore",
    "Ø³Ø§Ø¹Ø©",
];
exports.MINUTE_DATE_LIST = [
    "menit",
    "dakika",
    "min",
    "minute",
    "minuto",
    "à¸™à¸²à¸—à¸µ",
    "Ø¯Ù‚Ø§Ø¦Ù‚",
];
exports.SECONDS_DATE_LIST = ["detik", "segundo", "second", "à¸§à¸´à¸™à¸²à¸—à¸µ"];
exports.WEEK_DATE_LIST = ["week"];
exports.MONTH_DATE_LIST = ["month"];
exports.YEAR_DATE_LIST = ["year"];

},{"@suwatte/daisuke":9}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Controller = void 0;
const daisuke_1 = require("@suwatte/daisuke");
const cheerio_1 = require("cheerio");
const lodash_1 = require("lodash");
const constants_1 = require("./constants");
const parser_1 = require("./parser");
const utils_1 = require("./utils");
class Controller {
    context;
    client = new NetworkClient();
    parser = new parser_1.Parser();
    constructor(ctx) {
        this.context = ctx;
    }
    // Resolve Explore Collection
    async getCollection(excerpt) {
        const request = (0, utils_1.AJAXDirectoryRequest)(this.context, {
            sort: excerpt.id,
        });
        const response = await this.client.request(request);
        const highlights = this.parser.AJAXResponse(this.context, response.data);
        return { ...excerpt, highlights };
    }
    // Get Content
    async getContent(id) {
        const url = `${this.context.baseUrl}/${this.context.contentPath}/${id}/`;
        const response = await this.client.get(url);
        return {
            ...this.parser.content(this.context, response.data, id),
            webUrl: url,
        };
    }
    // Get Chapters
    async getChapters(id) {
        const url = `${this.context.baseUrl}/${this.context.contentPath}/${id}/`;
        const response = await this.client.get(url);
        const $ = (0, cheerio_1.load)(response.data);
        const wrapper = $("div[id^=manga-chapters-holder]");
        const elements = $(this.context.chapterSelector).toArray();
        if (elements.length == 0 && wrapper.length != 0) {
            const { data } = await this.client.post(url + "ajax/chapters", {
                headers: {
                    Referer: `${this.context.baseUrl}/`,
                    "X-Requested-With": "XMLHttpRequest",
                },
            });
            return this.parser.chapters(this.context, data, id);
        }
        else {
            return this.parser.chapters(this.context, response.data, id);
        }
    }
    // Get Chapter Data
    async getChapterData(contentId, chapterId) {
        const response = await this.client.get(`${this.context.baseUrl}/${this.context.contentPath}/${contentId}/${chapterId}`);
        return this.parser.chapterData(this.context, contentId, chapterId, response.data);
    }
    async getTags() {
        // parseGenres;
        const response = await this.client.get(`${this.context.baseUrl}/?s=genre&post_type=wp-manga`);
        const tags = this.parser.genres(this.context, response.data);
        return {
            id: "genres",
            label: "Genres",
            tags,
        };
    }
    async getExploreTags() {
        const tags = (await this.getTags()).tags;
        return (0, lodash_1.sampleSize)(tags, 7).map((v) => ({
            ...v,
            request: {
                filters: [{ id: "genres", included: [v.id] }],
            },
        }));
    }
    async getFilters() {
        const main = {
            id: "genres",
            title: "Genres",
            type: daisuke_1.FilterType.MULTISELECT,
            options: (await this.getTags()).tags,
        };
        const adult = {
            id: "adult",
            title: "Adult Content",
            type: daisuke_1.FilterType.SELECT,
            options: [
                {
                    id: "all",
                    label: "Show All",
                },
                {
                    id: "hidden",
                    label: "Hide Adult Titles",
                },
                {
                    id: "only",
                    label: "Show Only Adult Content",
                },
            ],
        };
        return [main, adult];
    }
    // Search
    async handleSearch(request) {
        const loadMore = this.context.useLoadMoreSearch;
        return loadMore
            ? this.searchWithLoadMore(request)
            : this.searchWithQueryParams(request);
    }
    async searchWithQueryParams(request) {
        const base = `${this.context.baseUrl}/page/${request.page ?? 1}/`;
        const params = {
            s: request.query,
            post_type: "wp-manga",
            m_orderby: request.sort ?? "views",
        };
        for (const filter of request.filters ?? []) {
            switch (filter.id) {
                case "genres":
                    if (!filter.included)
                        break;
                    params["genres[]"] = filter.included;
                    break;
                case "adult":
                    if (!filter.included || !filter.included[0])
                        break; // Guard
                    params["adult"] = filter.included[0] == "hidden" ? "0" : "1";
                    break;
            }
        }
        const response = await this.client.get(base, {
            params,
        });
        const data = this.parser.searchResponse(this.context, response.data, request.page ?? 1);
        return data;
    }
    async searchWithLoadMore(request) {
        const net = (0, utils_1.AJAXDirectoryRequest)(this.context, request, true);
        const response = await this.client.request(net);
        const highlights = this.parser.AJAXResponse(this.context, response.data);
        return {
            results: highlights,
            isLastPage: highlights.length <= 18,
            page: request.page ?? 1,
        };
    }
    getSorters() {
        if (this.context.useLoadMoreSearch) {
            return [
                {
                    label: "Popularity",
                    id: constants_1.AJAX_DIRECTORY.POPULAR_AT,
                },
                {
                    label: "Top Monthly",
                    id: constants_1.AJAX_DIRECTORY.TRENDING_MONTHLY,
                },
                {
                    label: "Top Daily",
                    id: constants_1.AJAX_DIRECTORY.TRENDING_DAILY,
                },
                {
                    label: "Rating",
                    id: constants_1.AJAX_DIRECTORY.TOP_RATED,
                },
                {
                    label: "New",
                    id: constants_1.AJAX_DIRECTORY.NEW,
                },
                {
                    label: "Name",
                    id: constants_1.AJAX_DIRECTORY.NAME,
                },
            ];
        }
        return [
            {
                label: "Views",
                id: "views",
            },
            {
                label: "Rating",
                id: "rating",
            },
            {
                label: "Trending",
                id: "trending",
            },
            {
                label: "Latest",
                id: "latest",
            },
            {
                label: "New",
                id: "new-manga",
            },
            {
                label: "Name",
                id: "alphabet",
            },
        ];
    }
}
exports.Controller = Controller;

},{"./constants":2,"./parser":5,"./utils":6,"@suwatte/daisuke":9,"cheerio":"cheerio","lodash":"lodash"}],4:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MadaraTemplate = void 0;
const daisuke_1 = require("@suwatte/daisuke");
const constants_1 = require("./constants");
const controller_1 = require("./controller");
class MadaraTemplate extends daisuke_1.Source {
    context;
    controller;
    constructor(ctx) {
        super();
        this.context = ctx;
        this.controller = new controller_1.Controller(ctx);
    }
    async willRequestImage(request) {
        request.headers = {
            ...request.headers,
            Referer: this.context.baseUrl + "/",
        };
        return request;
    }
    //
    async getContent(contentId) {
        return this.controller.getContent(contentId);
    }
    //
    getChapters(contentId) {
        return this.controller.getChapters(contentId);
    }
    //
    getChapterData(contentId, chapterId) {
        return this.controller.getChapterData(contentId, chapterId);
    }
    //
    getSearchFilters() {
        return this.controller.getFilters();
    }
    //
    async getSearchSorters() {
        return this.controller.getSorters();
    }
    //
    async getSearchResults(query) {
        return this.controller.handleSearch(query);
    }
    //
    async getSourceTags() {
        const main = await this.controller.getTags();
        return [main];
    }
    //
    getExplorePageTags() {
        return this.controller.getExploreTags();
    }
    //
    async createExploreCollections() {
        return constants_1.EXPLORE_SECTIONS;
    }
    //
    async resolveExploreCollection(excerpt) {
        return this.controller.getCollection(excerpt);
    }
}
exports.MadaraTemplate = MadaraTemplate;

},{"./constants":2,"./controller":3,"@suwatte/daisuke":9}],5:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Parser = void 0;
/* eslint-disable @typescript-eslint/no-non-null-assertion */
const daisuke_1 = require("@suwatte/daisuke");
const cheerio_1 = require("cheerio");
const lodash_1 = require("lodash");
const constants_1 = require("./constants");
const utils_1 = require("./utils");
class Parser {
    AJAXResponse(ctx, html) {
        const highlights = [];
        const $ = (0, cheerio_1.load)(html);
        for (const element of $(".page-item-detail")) {
            const title = $("a", $("h3.h5", element)).text();
            const id = $("a", $("h3.h5", element))
                .attr("href")
                ?.replace(`${ctx.baseUrl}/${ctx.contentPath}/`, "")
                .replace(/\/$/, "");
            if (!title || !id) {
                continue;
            }
            const imageElement = $("img", element);
            const imageURL = (0, utils_1.imageFromElement)(imageElement);
            highlights.push({
                contentId: id,
                title,
                cover: imageURL,
            });
        }
        return highlights;
    }
    content(ctx, html, contentId) {
        const $ = (0, cheerio_1.load)(html);
        // Title
        /**
         * Removes the Text from child elements so we get only the text from the H1 Tag
         * Reference: https://stackoverflow.com/a/8851526
         */
        const title = $(ctx.titleSelector)
            .first()
            ?.clone()
            .children()
            .remove()
            .end()
            .text()
            .trim();
        if (!title)
            throw new Error("Title not found\nPotentially incorrect selectors");
        // Author
        const authors = $(ctx.authorSelector)
            .toArray()
            .map((node) => (0, utils_1.generateAnchorTag)($, node))
            .filter(utils_1.notUpdating)
            .map((tag) => ({
            id: `${constants_1.TAG_PREFIX.author}|tag.title.toLowerCase()`,
            label: tag.title,
            adultContent: false,
        }));
        // Artists
        const artists = $(ctx.artistSelector)
            .toArray()
            .map((node) => (0, utils_1.generateAnchorTag)($, node))
            .filter(utils_1.notUpdating)
            .map((tag) => ({
            id: `${constants_1.TAG_PREFIX.artist}|tag.title.toLowerCase()`,
            label: tag.title,
            adultContent: false,
        }));
        // Creators
        const creators = Array.from(new Set(authors.concat(artists).map((v) => v.label)));
        // Summary
        let summary = "";
        const summaryNode = $(ctx.summarySelector);
        if ($(summaryNode, "p").text().trim()) {
            summary = $(summaryNode, "p")
                .toArray()
                .map((v) => {
                const elem = $(v);
                return elem.text().replace("<br>", "\n");
            })
                .join("\n\n")
                .trim();
        }
        else {
            summary = $(ctx.summarySelector).text().trim();
        }
        // Cover
        const coverElem = $(ctx.thumbnailSelector).first();
        const cover = (0, utils_1.imageFromElement)(coverElem);
        // Status
        const statusString = $(ctx.statusSelector).last()?.text().trim() ?? "";
        const status = (0, utils_1.parseStatus)(statusString);
        // Genres
        const genres = $(ctx.genreSelector)
            .toArray()
            .map((node) => (0, utils_1.generateAnchorTag)($, node))
            .map((v) => ({
            id: v
                .link.split("/")
                .filter((v) => v)
                .pop() ?? "",
            label: v.title,
            adultContent: ctx.adultTags.includes(v.title.toLowerCase()),
        }))
            .filter((v) => v.id);
        const hashtags = $(ctx.tagSelector)
            .toArray()
            .map((node) => (0, utils_1.generateAnchorTag)($, node))
            .map((v) => ({
            id: `${constants_1.TAG_PREFIX.hashtag}${v
                .link.split("/")
                .filter((v) => v)
                .pop() ?? ""}`,
            label: v.title,
            adultContent: ctx.adultTags.includes(v.title.toLowerCase()),
        }))
            .filter((v) => v.id.replace(constants_1.TAG_PREFIX.hashtag, ""));
        const additionalTitles = $(ctx.alternativeTitlesSelector)
            .first()
            .text()
            .trim()
            .split(";")
            .map(lodash_1.trim);
        const adultContent = genres.some((v) => v.adultContent);
        const properties = [
            {
                id: "main",
                label: "Genres",
                tags: genres,
            },
            {
                id: "supporting",
                label: "Tags",
                tags: hashtags,
            },
            {
                id: "creators",
                label: "Credits",
                tags: [
                    ...authors.map((v) => ({ ...v, label: `Story By ${v.label}` })),
                    ...artists.map((v) => ({ ...v, label: `Art By ${v.label}` })),
                ],
            },
        ];
        const chapters = this.chapters(ctx, html, contentId);
        return {
            contentId,
            title,
            cover,
            summary: summary ? summary : undefined,
            creators,
            status,
            adultContent,
            properties,
            ...(chapters.length > 0 && { chapters }),
            recommendedReadingMode: daisuke_1.ReadingMode.VERTICAL,
            additionalTitles: additionalTitles.length != 0 ? additionalTitles : undefined,
        };
    }
    chapters(ctx, html, contentId) {
        const $ = (0, cheerio_1.load)(html);
        const chapters = [];
        const nodes = $(ctx.chapterSelector).toArray();
        for (const [index, node] of nodes.entries()) {
            const elem = $(node);
            const id = $("a", elem)
                .first()
                .attr("href")
                ?.replace(`${ctx.baseUrl}/${ctx.contentPath}/${contentId}/`, "")
                .replace(/\/$/, "");
            if (!id)
                throw new Error("Failed to parse Chapter ID");
            const title = $("a", elem).first().text().trim();
            const numStr = id
                .match(/\D*(\d*-?\d*)\D*$/)
                ?.pop()
                ?.replace(/-/g, ".");
            const number = Number(numStr);
            const dateStr = $(ctx.chapterDateSelector, elem).first().text().trim();
            const date = (0, utils_1.parseDate)(dateStr);
            chapters.push({
                index,
                contentId,
                chapterId: id,
                number,
                date,
                title,
                language: "en_us",
            });
        }
        return chapters;
    }
    chapterData(ctx, contentId, chapterId, html) {
        const $ = (0, cheerio_1.load)(html);
        const nodes = $(ctx.imageSelector).toArray();
        const pages = nodes
            .map((node) => (0, utils_1.imageFromElement)($(node)).trim())
            .map((url) => ({ url }));
        return {
            contentId,
            chapterId,
            pages,
        };
    }
    // Parse Genres
    genres(ctx, html) {
        const $ = (0, cheerio_1.load)(html);
        const nodes = $("div.checkbox", "div.checkbox-group").toArray();
        const tags = nodes
            .map((node) => {
            const label = $("label", node).text().trim();
            const id = $("input[type=checkbox]", node).attr("value")?.trim() ?? "";
            const adultContent = ctx.adultTags.includes(label.toLowerCase());
            return { label, id, adultContent };
        })
            .filter((v) => v.id);
        return tags;
    }
    searchResponse(ctx, html, page) {
        const $ = (0, cheerio_1.load)(html);
        const nodes = $(ctx.searchSelector).toArray();
        const highlights = nodes.map((node) => {
            const title = $("a", node).attr("title");
            const contentId = $("a", node)
                .attr("href")
                ?.replace(`${ctx.baseUrl}/${ctx.contentPath}/`, "")
                .replace(/\/$/, "");
            if (!title || !contentId)
                throw "Failed to Parse Search Result";
            const cover = (0, utils_1.imageFromElement)($("img", node));
            return {
                title,
                contentId,
                cover,
            };
        });
        return {
            results: highlights,
            page,
            isLastPage: highlights.length <= (ctx.paginationLimit ?? 30),
        };
    }
}
exports.Parser = Parser;

},{"./constants":2,"./utils":6,"@suwatte/daisuke":9,"cheerio":"cheerio","lodash":"lodash"}],6:[function(require,module,exports){
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseRelativeDate = exports.parseDate = exports.parseStatus = exports.generateAnchorTag = exports.notUpdating = exports.imageFromElement = exports.AJAXDirectoryRequest = void 0;
const daisuke_1 = require("@suwatte/daisuke");
const moment_1 = __importDefault(require("moment"));
const constants_1 = require("./constants");
const AJAXDirectoryRequest = (ctx, request, searching = false) => {
    const body = generateAJAXRequest(ctx, request);
    if (!searching) {
        body["template"] = "madara-core/content/content-archive";
    }
    return {
        url: `${ctx.baseUrl}/wp-admin/admin-ajax.php`,
        method: "POST",
        headers: {
            "content-type": "application/x-www-form-urlencoded",
            referer: ctx.baseUrl + "/",
        },
        body,
    };
};
exports.AJAXDirectoryRequest = AJAXDirectoryRequest;
const generateAJAXRequest = (ctx, request) => {
    const body = {
        action: "madara_load_more",
        page: ((request.page ?? 1) - 1).toString(),
        template: "madara-core/content/content-search",
        "vars[paged]": "1",
        "vars[template]": "archive",
        "vars[sidebar]": "right",
        "vars[post_type]": "wp-manga",
        "vars[post_status]": "publish",
        "vars[manga_archives_item_layout]": "big_thumbnail",
        "vars[posts_per_page]": "30",
    };
    if (ctx.filterNonMangaItems && ctx.showOnlyManga) {
        body["vars[meta_query][0][key]"] = "_wp_manga_chapter_type";
        body["vars[meta_query][0][value]"] = "manga";
    }
    if (request.sort) {
        switch (request.sort) {
            case "latest":
                body["vars[orderby]"] = "meta_value_num";
                body["vars[order]"] = "DESC";
                body["vars[meta_key]"] = "_latest_update";
                break;
            case "alphabet":
                body["vars[orderby]"] = "post_title";
                body["vars[order]"] = "ASC";
                break;
            case "rating":
                body["vars[orderby][query_average_reviews]"] = "DESC";
                body["vars[orderby][query_total_reviews]"] = "DESC";
                break;
            case "trending_daily":
                body["vars[orderby]"] = "meta_value_num";
                body["vars[meta_key]"] = "_wp_manga_day_views_value";
                body["vars[order]"] = "DESC";
                break;
            case "trending_weekly":
                body["vars[orderby]"] = "meta_value_num";
                body["vars[meta_key]"] = "_wp_manga_week_views_value";
                body["vars[order]"] = "DESC";
                break;
            case "trending_monthly":
                body["vars[orderby]"] = "meta_value_num";
                body["vars[meta_key]"] = "_wp_manga_month_views_value";
                body["vars[order]"] = "DESC";
                break;
            case "popular_allTime":
                body["vars[orderby]"] = "meta_value_num";
                body["vars[meta_key]"] = "_wp_manga_views";
                body["vars[order]"] = "DESC";
                break;
            case "new":
                body["vars[orderby]"] = "date";
                body["vars[order]"] = "DESC";
                break;
            case "completed":
                body["vars[orderby]"] = "meta_value_num";
                body["vars[meta_value]"] = "end";
                body["vars[meta_key]"] = "_wp_manga_status";
                break;
        }
    }
    if (request.query) {
        body["vars[s]"] = request.query;
    }
    return body;
};
const imageFromElement = (element) => {
    const url = element.attr("data-src") ??
        element.attr("data-lazy-src") ??
        element.attr("srcset")?.split(" ")?.[0] ??
        element.attr("src") ??
        element.attr("data-cfsrc") ??
        "https://aegaeon.mantton.com/ceres.jpeg";
    return url
        .replace("-110x150", "")
        .replace("-175x238", "")
        .replace("-193x278", "")
        .replace("-224x320", "")
        .replace("-350x476", "");
};
exports.imageFromElement = imageFromElement;
const notUpdating = (tag) => {
    const regex = /Updating|Atualizando/;
    return !tag.title.trim().match(regex);
};
exports.notUpdating = notUpdating;
const generateAnchorTag = ($, node) => {
    const elem = $(node);
    const link = elem.attr("href");
    const title = elem.text().trim();
    return { link, title };
};
exports.generateAnchorTag = generateAnchorTag;
const parseStatus = (str) => {
    if (constants_1.COMPLETED_STATUS_LIST.includes(str))
        return daisuke_1.Status.COMPLETED;
    if (constants_1.ONGOING_STATUS_LIST.includes(str))
        return daisuke_1.Status.ONGOING;
    if (constants_1.HIATUS_STATUS_LIST.includes(str))
        return daisuke_1.Status.HIATUS;
    if (constants_1.CANCELLED_STATUS_LIST.includes(str))
        return daisuke_1.Status.CANCELLED;
    return daisuke_1.Status.UNKNOWN;
};
exports.parseStatus = parseStatus;
const parseDate = (str, format) => {
    if (["just", "now", "up"].some((v) => str.trim().toLowerCase().includes(v)))
        return new Date();
    if (str.trim().toLowerCase() === "yesterday")
        return (0, moment_1.default)().subtract(1, "day").toDate();
    return (0, exports.parseRelativeDate)(str)?.toDate() ?? (0, moment_1.default)(str, format).toDate();
};
exports.parseDate = parseDate;
const parseRelativeDate = (str) => {
    const numStr = str.match(/(\d+)/)?.[1];
    if (!numStr || Number.isNaN(parseInt(numStr))) {
        return null;
    }
    const number = parseInt(numStr);
    const now = (0, moment_1.default)();
    if (constants_1.DAY_DATE_LIST.some((v) => str.toLowerCase().includes(v)))
        return now.subtract(number, "days");
    if (constants_1.HOUR_DATE_LIST.some((v) => str.toLowerCase().includes(v)))
        return now.subtract(number, "hours");
    if (constants_1.MINUTE_DATE_LIST.some((v) => str.toLowerCase().includes(v)))
        return now.subtract(number, "minutes");
    if (constants_1.SECONDS_DATE_LIST.some((v) => str.toLowerCase().includes(v)))
        return now.subtract(number, "seconds");
    if (constants_1.WEEK_DATE_LIST.some((v) => str.toLowerCase().includes(v)))
        return now.subtract(number, "weeks");
    if (constants_1.MONTH_DATE_LIST.some((v) => str.toLowerCase().includes(v)))
        return now.subtract(number, "months");
    if (constants_1.YEAR_DATE_LIST.some((v) => str.toLowerCase().includes(v)))
        return now.subtract(number, "years");
    return null;
};
exports.parseRelativeDate = parseRelativeDate;

},{"./constants":2,"@suwatte/daisuke":9,"moment":"moment"}],7:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Source = void 0;
class Source {
}
exports.Source = Source;

},{}],8:[function(require,module,exports){
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", { value: true });
__exportStar(require("./Source"), exports);

},{"./Source":7}],9:[function(require,module,exports){
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", { value: true });
__exportStar(require("./classes"), exports);
__exportStar(require("./types"), exports);

},{"./classes":8,"./types":26}],10:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });

},{}],11:[function(require,module,exports){
arguments[4][10][0].apply(exports,arguments)
},{"dup":10}],12:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CollectionStyle = void 0;
var CollectionStyle;
(function (CollectionStyle) {
    CollectionStyle[CollectionStyle["NORMAL"] = 0] = "NORMAL";
    CollectionStyle[CollectionStyle["INFO"] = 1] = "INFO";
    CollectionStyle[CollectionStyle["GALLERY"] = 2] = "GALLERY";
    CollectionStyle[CollectionStyle["UPDATE_LIST"] = 3] = "UPDATE_LIST";
})(CollectionStyle = exports.CollectionStyle || (exports.CollectionStyle = {}));

},{}],13:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ContentType = exports.ReadingFlag = exports.ReadingMode = exports.Status = void 0;
// Enums
var Status;
(function (Status) {
    Status[Status["UNKNOWN"] = 0] = "UNKNOWN";
    Status[Status["ONGOING"] = 1] = "ONGOING";
    Status[Status["COMPLETED"] = 2] = "COMPLETED";
    Status[Status["CANCELLED"] = 3] = "CANCELLED";
    Status[Status["HIATUS"] = 4] = "HIATUS";
})(Status = exports.Status || (exports.Status = {}));
/**
 * The method in which the content can be read
 */
var ReadingMode;
(function (ReadingMode) {
    ReadingMode[ReadingMode["PAGED_MANGA"] = 0] = "PAGED_MANGA";
    ReadingMode[ReadingMode["PAGED_COMIC"] = 1] = "PAGED_COMIC";
    ReadingMode[ReadingMode["VERTICAL"] = 2] = "VERTICAL";
    ReadingMode[ReadingMode["VERTICAL_SEPARATED"] = 3] = "VERTICAL_SEPARATED";
    ReadingMode[ReadingMode["NOVEL"] = 4] = "NOVEL";
    ReadingMode[ReadingMode["WEB"] = 5] = "WEB";
})(ReadingMode = exports.ReadingMode || (exports.ReadingMode = {}));
var ReadingFlag;
(function (ReadingFlag) {
    ReadingFlag[ReadingFlag["READING"] = 0] = "READING";
    ReadingFlag[ReadingFlag["PLANNED"] = 1] = "PLANNED";
    ReadingFlag[ReadingFlag["COMPLETED"] = 2] = "COMPLETED";
    ReadingFlag[ReadingFlag["DROPPED"] = 3] = "DROPPED";
    ReadingFlag[ReadingFlag["REREADING"] = 4] = "REREADING";
    ReadingFlag[ReadingFlag["PAUSED"] = 5] = "PAUSED";
    ReadingFlag[ReadingFlag["UNKNOWN"] = 6] = "UNKNOWN";
})(ReadingFlag = exports.ReadingFlag || (exports.ReadingFlag = {}));
var ContentType;
(function (ContentType) {
    ContentType[ContentType["NOVEL"] = 0] = "NOVEL";
    ContentType[ContentType["MANGA"] = 1] = "MANGA";
    ContentType[ContentType["MANHUA"] = 2] = "MANHUA";
    ContentType[ContentType["MANHWA"] = 3] = "MANHWA";
    ContentType[ContentType["COMIC"] = 4] = "COMIC";
    ContentType[ContentType["UNKNOWN"] = 5] = "UNKNOWN";
})(ContentType = exports.ContentType || (exports.ContentType = {}));

},{}],14:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FilterType = void 0;
var FilterType;
(function (FilterType) {
    FilterType[FilterType["TOGGLE"] = 0] = "TOGGLE";
    FilterType[FilterType["SELECT"] = 1] = "SELECT";
    FilterType[FilterType["MULTISELECT"] = 2] = "MULTISELECT";
    FilterType[FilterType["EXCLUDABLE_MULTISELECT"] = 3] = "EXCLUDABLE_MULTISELECT";
    FilterType[FilterType["TEXT"] = 4] = "TEXT";
    FilterType[FilterType["INFO"] = 5] = "INFO";
})(FilterType = exports.FilterType || (exports.FilterType = {}));

},{}],15:[function(require,module,exports){
arguments[4][10][0].apply(exports,arguments)
},{"dup":10}],16:[function(require,module,exports){
arguments[4][10][0].apply(exports,arguments)
},{"dup":10}],17:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Types

},{}],18:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProviderLinkType = void 0;
var ProviderLinkType;
(function (ProviderLinkType) {
    ProviderLinkType[ProviderLinkType["WEBSITE"] = 0] = "WEBSITE";
    ProviderLinkType[ProviderLinkType["TWITTER"] = 1] = "TWITTER";
    ProviderLinkType[ProviderLinkType["DISCORD"] = 2] = "DISCORD";
    ProviderLinkType[ProviderLinkType["PATREON"] = 3] = "PATREON";
})(ProviderLinkType = exports.ProviderLinkType || (exports.ProviderLinkType = {}));

},{}],19:[function(require,module,exports){
arguments[4][10][0].apply(exports,arguments)
},{"dup":10}],20:[function(require,module,exports){
arguments[4][10][0].apply(exports,arguments)
},{"dup":10}],21:[function(require,module,exports){
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", { value: true });
__exportStar(require("./Content"), exports);
__exportStar(require("./Highlight"), exports);
__exportStar(require("./Chapter"), exports);
__exportStar(require("./ChapterData"), exports);
__exportStar(require("./SearchRequest"), exports);
__exportStar(require("./PagedResult"), exports);
__exportStar(require("./TrackerInfo"), exports);
__exportStar(require("./Property"), exports);
__exportStar(require("./Collection"), exports);
__exportStar(require("./Provider"), exports);
__exportStar(require("./Filter"), exports);

},{"./Chapter":10,"./ChapterData":11,"./Collection":12,"./Content":13,"./Filter":14,"./Highlight":15,"./PagedResult":16,"./Property":17,"./Provider":18,"./SearchRequest":19,"./TrackerInfo":20}],22:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AuthMethod = void 0;
var AuthMethod;
(function (AuthMethod) {
    AuthMethod[AuthMethod["USERNAME_PW"] = 0] = "USERNAME_PW";
    AuthMethod[AuthMethod["EMAIL_PW"] = 1] = "EMAIL_PW";
    AuthMethod[AuthMethod["WEB"] = 2] = "WEB";
    AuthMethod[AuthMethod["OAUTH"] = 3] = "OAUTH";
})(AuthMethod = exports.AuthMethod || (exports.AuthMethod = {}));

},{}],23:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ButtonPreference = exports.TextFieldPreference = exports.TogglePreference = exports.StepperPreference = exports.MultiSelectPreference = exports.SelectPreference = exports.PreferenceType = void 0;
var PreferenceType;
(function (PreferenceType) {
    PreferenceType[PreferenceType["SELECT"] = 0] = "SELECT";
    PreferenceType[PreferenceType["MULTISELECT"] = 1] = "MULTISELECT";
    PreferenceType[PreferenceType["STEPPER"] = 2] = "STEPPER";
    PreferenceType[PreferenceType["TOGGLE"] = 3] = "TOGGLE";
    PreferenceType[PreferenceType["TEXTFIELD"] = 4] = "TEXTFIELD";
    PreferenceType[PreferenceType["BUTTON"] = 5] = "BUTTON";
})(PreferenceType = exports.PreferenceType || (exports.PreferenceType = {}));
class Preference {
    constructor(key, type, label, value) {
        this.key = key;
        this.type = type;
        this.label = label;
        this.value = value;
    }
}
class SelectPreference extends Preference {
    constructor({ key, label, options, value }) {
        super(key, PreferenceType.SELECT, label, value);
        this.options = options;
    }
}
exports.SelectPreference = SelectPreference;
class MultiSelectPreference extends Preference {
    constructor({ key, label, options, value, maxSelectionCount, minSelectionCount, }) {
        super(key, PreferenceType.MULTISELECT, label, value);
        this.options = options;
        this.maxSelectionCount = maxSelectionCount;
        this.minSelectionCount = minSelectionCount;
    }
}
exports.MultiSelectPreference = MultiSelectPreference;
class StepperPreference extends Preference {
    constructor({ key, value, label, minValue, maxValue, }) {
        super(key, PreferenceType.STEPPER, label, value);
        this.maxValue = maxValue;
        this.minValue = minValue;
    }
}
exports.StepperPreference = StepperPreference;
class TogglePreference extends Preference {
    constructor({ key, label, value }) {
        super(key, PreferenceType.TOGGLE, label, value);
    }
}
exports.TogglePreference = TogglePreference;
class TextFieldPreference extends Preference {
    constructor({ key, label, value }) {
        super(key, PreferenceType.TEXTFIELD, label, value);
    }
}
exports.TextFieldPreference = TextFieldPreference;
class ButtonPreference extends Preference {
    constructor({ key, label, action, systemImage, isDestructive, }) {
        super(key, PreferenceType.BUTTON, label, {
            get: function () {
                throw new Error("Method Is Never Called");
            },
            set: function (value) {
                throw new Error("Method Is Never Called");
            },
        });
        this.action = action;
        this.systemImage = systemImage;
        this.isDestructive = isDestructive;
    }
}
exports.ButtonPreference = ButtonPreference;

},{}],24:[function(require,module,exports){
arguments[4][10][0].apply(exports,arguments)
},{"dup":10}],25:[function(require,module,exports){
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", { value: true });
__exportStar(require("./Authentication"), exports);
__exportStar(require("./Preferences"), exports);
__exportStar(require("./RunnerInfo"), exports);

},{"./Authentication":22,"./Preferences":23,"./RunnerInfo":24}],26:[function(require,module,exports){
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", { value: true });
__exportStar(require("./core"), exports);
__exportStar(require("./content"), exports);
__exportStar(require("./networking"), exports);

},{"./content":21,"./core":25,"./networking":27}],27:[function(require,module,exports){
arguments[4][10][0].apply(exports,arguments)
},{"dup":10}]},{},[1])(1)
});
